<div class="recipe-detail-container" *ngIf="recipe()">
  <div class="top-controls">
    <button class="back-button" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      {{ translations().backToRecipes }}
    </button>
    <div class="right-controls">
      <button
        class="cooking-mode-button"
        (click)="toggleCookingMode()"
        [class.active]="cookingMode()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path>
          <line x1="6" y1="17" x2="18" y2="17"></line>
        </svg>
        {{ cookingMode() ? translations().exitCooking : translations().startCooking }}
      </button>
      <app-language-toggle></app-language-toggle>
    </div>
  </div>

  <div class="recipe-header">
    <div class="recipe-header-image">
      <img [src]="recipe().image" [alt]="recipe().name" />
    </div>
    <div class="recipe-header-content">
      <div class="cuisine-badge">{{ recipe().cuisine }}</div>
      <h1>{{ recipe().name }}</h1>

      <div class="recipe-stats">
        <div class="stat">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
          </svg>
          <div>
            <div class="stat-label">Category</div>
            <div class="stat-value">{{ recipe().category }}</div>
          </div>
        </div>

        @if (recipe().tags && recipe().tags!.length > 0) {
          <div class="stat">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
              <line x1="7" y1="7" x2="7.01" y2="7"></line>
            </svg>
            <div>
              <div class="stat-label">Tags</div>
              <div class="stat-value">{{ recipe().tags!.join(', ') }}</div>
            </div>
          </div>
        }

        @if (recipe().youtubeUrl) {
          <div class="stat">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <div>
              <div class="stat-label">Video</div>
              <div class="stat-value">
                <a [href]="recipe().youtubeUrl" target="_blank" rel="noopener noreferrer">Watch on YouTube</a>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Desktop view: side by side -->
  <div class="recipe-body desktop-view">
    <div class="ingredients-section">
      <h2>{{ translations().ingredients }}</h2>
      <ul class="ingredients-list" [class.cooking-mode]="cookingMode()">
        <li *ngFor="let ingredient of recipe().ingredients; let i = index"
            [class.checked]="cookingMode() && isIngredientChecked(i)"
            (click)="cookingMode() ? toggleIngredient(i) : null"
            [class.clickable]="cookingMode()">
          <span *ngIf="cookingMode()" class="checkbox" [class.checked]="isIngredientChecked(i)">
            <svg *ngIf="isIngredientChecked(i)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </span>
          <span class="ingredient-text">{{ ingredient }}</span>
        </li>
      </ul>
    </div>

    <div class="instructions-section">
      <h2>{{ translations().instructions }}</h2>
      <ol class="instructions-list">
        <li *ngFor="let instruction of recipe().instructions; let i = index"
            [class.checked]="cookingMode() && isStepChecked(i)"
            (click)="cookingMode() ? toggleStep(i) : null"
            [class.clickable]="cookingMode()">
          <div class="step-content">
            <span class="step-number" [class.checked]="cookingMode() && isStepChecked(i)">
              <svg *ngIf="cookingMode() && isStepChecked(i)" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span *ngIf="!cookingMode() || !isStepChecked(i)">{{ i + 1 }}</span>
            </span>
            <p>{{ instruction }}</p>
          </div>
        </li>
      </ol>
    </div>
  </div>

  <!-- Mobile view: tabs -->
  <div class="recipe-body mobile-view">
    <p-tabs [(value)]="activeTabIndex">
      <p-tablist>
        <p-tab value="0">{{ translations().ingredients }}</p-tab>
        <p-tab value="1">{{ translations().instructions }}</p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          <ul class="ingredients-list" [class.cooking-mode]="cookingMode()">
            <li *ngFor="let ingredient of recipe().ingredients; let i = index"
                [class.checked]="cookingMode() && isIngredientChecked(i)"
                (click)="cookingMode() ? toggleIngredient(i) : null"
                [class.clickable]="cookingMode()">
              <span *ngIf="cookingMode()" class="checkbox" [class.checked]="isIngredientChecked(i)">
                <svg *ngIf="isIngredientChecked(i)" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </span>
              <span class="ingredient-text">{{ ingredient }}</span>
            </li>
          </ul>
        </p-tabpanel>
        <p-tabpanel value="1">
          <ol class="instructions-list">
            <li *ngFor="let instruction of recipe().instructions; let i = index"
                [class.checked]="cookingMode() && isStepChecked(i)"
                (click)="cookingMode() ? toggleStep(i) : null"
                [class.clickable]="cookingMode()">
              <div class="step-content">
                <span class="step-number" [class.checked]="cookingMode() && isStepChecked(i)">
                  <svg *ngIf="cookingMode() && isStepChecked(i)" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  <span *ngIf="!cookingMode() || !isStepChecked(i)">{{ i + 1 }}</span>
                </span>
                <p>{{ instruction }}</p>
              </div>
            </li>
          </ol>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>
</div>

<div class="not-found" *ngIf="!recipe()">
  <h2>{{ translations().recipeNotFound }}</h2>
  <button class="back-button" (click)="goBack()">{{ translations().backToRecipes }}</button>
</div>
